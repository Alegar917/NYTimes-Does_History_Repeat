<!DOCTYPE html>
<meta charset="utf-8">
<style> 

.bar:hover {
  fill: brown;
}

.zoom {
  cursor: move;
  fill: none;
  pointer-events: all;
}

.y {
  font: 11px sans-serif Arial; 
  /* font-weight: bold; */
  color: black;
}


div.tooltip {
  position: absolute;
  text-align: center;
	top: 150px;
	left: 650px;
  width: 150px;
} 


  #wrapper-chart{

    /* position: relative;
    left: 400px; 
    /* top: 40px;  */

  width: 100px;
	height: 100px;
	
	position: relative;
	top: 10px;
	bottom: 0;
	left: -500px;
	right: 0;
  	
	margin: auto;
  }


</style>


<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://d3js.org/d3.v6.min.js"></script>

  <!-- TODO: Change title -->
  <title>barchart</title>

  <!-- Load Bulma from CDN (consider saving it to repository instead) -->
  <!-- https://bulma.io/ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">

  <!-- Load Font Awesome 5 (free) icons -->
  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>


<body>

  <!-- Page header -->
  <section class="hero is-black is-bold noprint">
    <div class="hero-body">
      <div class="container">
        <!-- TODO: Change title -->
        <h1 class="title">Bar Chart</h1>
        <!-- TODO: Change subtitle -->
        <h2 class="subtitle">Top 100 keywords from 1981-2019</h2>
      </div>
    </div>
  </section>
  <!-- End page header -->

 
  <!-- Page navigation -->
  <nav class="navbar is-light" role="navigation" aria-label="main navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item is-active" href="index.html">
          <span class="icon"><i class="fas fa-home"></i></span>
          <span>Home</span>
        </a>

        <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="main-menu">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>

      <div id="main-menu" class="navbar-menu has-text-weight-medium">
        <!-- Left navbar items -->
        <div class="navbar-start">
          <a class="navbar-item" href="#data" title="Data">
            <span class="icon"><i class="fas fa-table"></i></span>
            <span>Data</span>
          </a>

          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              Visualizations
            </a>

            <div class="navbar-dropdown">
              <a class="navbar-item" href="new_keywords/line.html">
                <span class="icon"><i class="fas fa-chart-line"></i></span>
                <span>Line Chart</span>
              </a>

              <a class="navbar-item" href="bar.html">
                <span class="icon"><i class="fas fa-chart-bar"></i></span>
                <span>Bar Chart</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Right navbar items -->
        <div class="navbar-end">
          <a class="navbar-item" href="#about" title="About">
            <span class="icon"><i class="fas fa-info-circle"></i></span>
            <span>About</span>
          </a>
        </div>
      </div>
    </div>
  </nav>
  <!-- End page navigation -->

  <div  id="wrapper-chart" >
    <div class="graph" id="viz" style="width: 1000px; height: 400px; overflow-y: scroll "> </div>
    <div id="xaxis"></div>
    <!-- <div class = "legend" id="legend"></div> -->
</div>

<script>

d3.json("CategoryResult.json").then(function(json) {

data = []

for(i = 0; i < 100; i++) {
data.push(json[i])
}

// console.log(data)

word = data.map(value => value.value);
count = data.map(value => value.count);
maxcategory = data.map(value => value.key);

category = maxcategory.filter((c, index) => {
    return maxcategory.indexOf(c) === index;
});

console.log(category)




// // set the dimensions and margins of the graph
var margin = {top: 19, right: 20, bottom: 28, left: 250},
    width = 960 - margin.left - margin.right,
    height = 1100 - margin.top - margin.bottom;

    // width = 900 - margin.left - margin.right,
    // height = 2000 - margin.top - margin.bottom;



// // set the ranges
var y = d3.scaleBand()
          .range([0, height])
          .padding(0.5);
          

var x = d3.scaleLinear()
          .range([0, width]);





var color = d3.scaleOrdinal().range(["#2ca02c","#00acc1","#f89d4e","#c24e9f","#e93018"]);
          

var svg = d3.select("body").select(".graph").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top )
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top   + ")");


var div = d3.select("body").select(".graph").append("div")
     .attr("class", "tooltip")
     .style("opacity", 0);

var xaxis_svg = d3.select('#xaxis')
    .append('svg')
    .attr("width", width + margin.left + margin.right)
  	.attr("height", margin.bottom + 100)
    .append('g')
    .attr("transform", "translate(" + margin.left + "," + 0 + ")");




var number = d3.format(",");
//   // Scale the range of the data in the domains

  x.domain([0, d3.max(count)])
  y.domain(word);
  color.domain(category);


//   // append the rectangles for the bar chart
  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      //.attr("x", function(d) { return x(d.sales); })
      .attr("width", function(d) {return x(d.count); })
      .attr("y", function(d) { return y(d.value); })
      .attr("height", y.bandwidth())
      .attr("fill", function (d){ return color(d.key); })
    
      .on('mouseover', function(event, d) {
          div.transition()
               .duration(100)
               .style("opacity", 1);

          div.html("Total Count:     " + number(d.count))
              // .style("position", "fixed") 
              //  .style("left", (1000) + "px")             
              //  .style("top", (400) + "px");

  		})
  		.on('mouseout', function(d) {
          
          div.transition()
                // .duration(200)
                .style("opacity", 0);
             
      });

// add the x Axis

xaxis_svg.append('g')
    .attr('class', 'x axis')
    .attr('transform', 'translate(0,' + 0 + ')')
    .call(d3.axisBottom(x))

// add the y Axis
   svg.append("g")
    .attr('class', 'y axis')
    .call(d3.axisLeft(y));
    


xaxis_svg.append("circle")
  .attr("cx", 20)
  .attr("cy", margin.bottom)
  .attr("r", 5)
  .style("fill", color("creative_works"))
  .style("stroke", "black")

  xaxis_svg.append("circle")
  .attr("cx", 145)
  .attr("cy", margin.bottom)
  .attr("r", 5)
  .style("fill",  color("persons"))
  .style("stroke", "black")

  xaxis_svg.append("circle")
  .attr("cx", 230)
  .attr("cy", margin.bottom)
  .attr("r", 5)
  .style("fill",  color("organizations"))
  .style("stroke", "black")
  
  xaxis_svg.append("circle")
  .attr("cx", 350)
  .attr("cy", margin.bottom)
  .attr("r", 5)
  .style("fill", color("subject"))
  .style("stroke", "black")

  xaxis_svg.append("circle")
  .attr("cx", 430)
  .attr("cy", margin.bottom)
  .attr("r", 5)
  .style("fill", color("glocations"))
  .style("stroke", "black")



  xaxis_svg.append("text")
  .attr("class", "legend-text")
  .attr("x", 30)
  .attr("y", 34)
  .text("creative works")
  .attr("alignment-baseline", "middle")

  xaxis_svg.append("text")
  .attr("class", "legend-text")
  .attr("x", 155)
  .attr("y", 34)
  .text("persons")
  .attr("alignment-baseline", "middle")

  xaxis_svg.append("text")
  .attr("class", "legend-text")
  .attr("x",240)
  .attr("y", 34)
  .text("organizations")
  .attr("alignment-baseline", "middle")

  xaxis_svg.append("text")
  .attr("class", "legend-text")
  .attr("x", 360)
  .attr("y", 34)
  .text("subject")
  .attr("alignment-baseline", "middle")

  xaxis_svg.append("text")
  .attr("class", "legend-text")
  .attr("x", 440)
  .attr("y", 34)
  .text("glocations")
  .attr("alignment-baseline", "middle")

})

</script>
</body>
</html>